# Apache configuration for Shahr-e Raze CMS
# Place this file in your Apache sites-available directory

<VirtualHost *:80>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    
    # Redirect all HTTP traffic to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName your-domain.com
    ServerAlias www.your-domain.com
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    SSLCertificateChainFile /path/to/your/chain.pem
    
    # Document root for static files
    DocumentRoot /path/to/your/project/staticfiles
    
    # Serve static files directly with Apache
    Alias /static/ /path/to/your/project/staticfiles/
    <Directory /path/to/your/project/staticfiles>
        Require all granted
        Options -Indexes
    </Directory>
    
    # Serve media files
    Alias /media/ /path/to/your/project/media/
    <Directory /path/to/your/project/media>
        Require all granted
        Options -Indexes
    </Directory>
    
    # Proxy pass to Django application
    ProxyPreserveHost On
    ProxyPass /static/ !
    ProxyPass /media/ !
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/cms_error.log
    CustomLog ${APACHE_LOG_DIR}/cms_access.log combined
</VirtualHost>

# Enable required modules
# a2enmod rewrite proxy proxy_http ssl headers